<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>單字卡（備份碼版）</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
    <button id="btnMenu" class="icon-btn" aria-label="開啟選單" title="選單">☰</button>
    <div class="brand">
      <div class="brand-title">單字卡</div>
      <div class="brand-sub">紫色莫蘭迪 · 隨機抽卡 · 備份碼同步</div>
    </div>
    <div class="topbar-right">
      <span id="saveDot" class="sync-dot" title="儲存狀態"></span>
    </div>
  </header>

  <aside id="drawer" class="drawer" aria-hidden="true">
    <div class="drawer-head">
      <div class="drawer-title">功能</div>
      <button id="btnCloseMenu" class="icon-btn" aria-label="關閉選單" title="關閉">✕</button>
    </div>

    <nav class="drawer-nav">
      <button class="nav-btn" data-view="cards">單字卡</button>
      <button class="nav-btn" data-view="add">新增單字</button>
      <button class="nav-btn" data-view="list">單字列表</button>
      <button class="nav-btn" data-view="backup">備份</button>
    </nav>

    <div class="drawer-section">
      <div class="section-title">提示</div>
      <div class="muted tiny">
        備份碼＝把你的單字資料打包成一段文字。<br/>
        換手機/換電腦：生成 → 複製 → 貼上還原。
      </div>
    </div>
  </aside>

  <div id="backdrop" class="backdrop" hidden></div>

  <main class="container">
    <!-- 單字卡 -->
    <section id="view-cards" class="view">
      <div class="panel">
        <div class="panel-head">
          <div>
            <div class="h1">單字卡</div>
            <div class="muted">點卡片翻面；左右滑（或←→）換下一張。</div>
          </div>
          <div class="pill-row">
            <span class="pill" id="pillCount">0 張</span>
            <span class="pill" id="pillRound">本輪：0 / 0</span>
          </div>
        </div>

        <div id="cardStage" class="card-stage" tabindex="0" aria-label="單字卡區域">
          <div id="flashcard" class="flashcard" role="button" aria-label="點擊翻面">
            <div class="card-face card-front">
              <div id="cardWord" class="card-word">尚無單字</div>
            </div>
            <div class="card-face card-back">
              <div id="cardPos" class="card-pos">—</div>
              <div id="cardZh" class="card-zh">去新增一點吧</div>
            </div>
          </div>

          <div class="swipe-hint muted">← 往左 / 往右 → 換卡</div>
        </div>

        <div class="panel-foot">
          <button id="btnPrev" class="btn secondary">← 上一張</button>
          <button id="btnNext" class="btn primary">下一張 →</button>
        </div>
      </div>
    </section>

    <!-- 新增單字 -->
    <section id="view-add" class="view hidden">
      <div class="panel">
        <div class="panel-head">
          <div>
            <div class="h1">新增單字</div>
            <div class="muted">三欄必填。若單字已存在，會先詢問是否覆蓋更新。</div>
          </div>
        </div>

        <form id="addForm" class="form">
          <label class="label">
            英文單字
            <input id="inWord" class="input" placeholder="e.g. abandon" maxlength="64" />
          </label>

          <label class="label">
            詞性
            <select id="inPos" class="input">
              <option value="">請選擇…</option>
              <option>n.</option>
              <option>v.</option>
              <option>adj.</option>
              <option>adv.</option>
              <option>prep.</option>
              <option>conj.</option>
              <option>phr.</option>
              <option>其他</option>
            </select>
          </label>

          <label class="label">
            中文
            <input id="inZh" class="input" placeholder="e.g. 放棄；遺棄" maxlength="120" />
          </label>

          <div class="form-actions">
            <button type="button" id="btnClearAdd" class="btn ghost">清空</button>
            <button type="submit" class="btn primary">儲存</button>
          </div>
        </form>
      </div>
    </section>

    <!-- 單字列表 -->
    <section id="view-list" class="view hidden">
      <div class="panel">
        <div class="panel-head">
          <div>
            <div class="h1">單字列表</div>
            <div class="muted">英文／詞性／中文對齊；右側顯示「累積出現次數」；可編輯（有防呆）。</div>
          </div>

          <div class="search-row">
            <input id="search" class="input" placeholder="搜尋英文或中文…" />
          </div>
        </div>

        <div class="table-wrap">
          <table class="table" aria-label="單字列表">
            <thead>
              <tr>
                <th class="col-word">英文</th>
                <th class="col-pos">詞性</th>
                <th>中文</th>
                <th class="col-count">出現次數</th>
                <th class="col-action">操作</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>

        <div id="emptyList" class="empty muted" hidden>
          目前還沒有單字。去「新增單字」先塞一點彈藥吧。
        </div>
      </div>
    </section>

    <!-- 備份 -->
    <section id="view-backup" class="view hidden">
      <div class="panel">
        <div class="panel-head">
          <div>
            <div class="h1">備份</div>
            <div class="muted">
              生成備份碼後複製，換裝置貼上還原即可。<br/>
              你也可以下載/匯入 JSON（更保險）。
            </div>
          </div>
        </div>

        <div class="backup">
          <div class="backup-actions">
            <button id="btnGenCode" class="btn primary">產生備份碼</button>
            <button id="btnCopyCode" class="btn secondary">複製備份碼</button>
            <button id="btnDownloadJson" class="btn ghost">下載 JSON</button>
          </div>

          <label class="label">
            備份碼（很長很正常，但我已幫你壓縮了）
            <textarea id="backupCode" class="textarea" rows="7" placeholder="按「產生備份碼」會出現在這裡"></textarea>
          </label>

          <div class="restore">
            <div class="restore-head">
              <div class="h2">還原 / 匯入</div>
              <div class="muted tiny">先預覽、再確認（雙層防呆）。</div>
            </div>

            <div class="restore-row">
              <label class="radio">
                <input type="radio" name="restoreMode" value="merge" checked />
                合併（同英文單字→更新；不重複→新增）
              </label>
              <label class="radio">
                <input type="radio" name="restoreMode" value="overwrite" />
                覆蓋（用備份整包取代目前資料）
              </label>
            </div>

            <div class="backup-actions">
              <button id="btnPreviewRestore" class="btn secondary">預覽還原結果</button>
              <button id="btnConfirmRestore" class="btn danger" disabled>確認還原</button>
              <label class="btn ghost filebtn">
                匯入 JSON
                <input id="fileJson" type="file" accept="application/json" hidden />
              </label>
            </div>

            <div id="restorePreview" class="preview muted" hidden></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- 編輯 Modal -->
  <div id="modal" class="modal" hidden>
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="編輯單字">
      <div class="modal-head">
        <div class="modal-title">編輯單字</div>
        <button id="btnCloseModal" class="icon-btn" aria-label="關閉">✕</button>
      </div>

      <div class="modal-body">
        <label class="label">
          英文單字
          <input id="editWord" class="input" maxlength="64" />
        </label>

        <label class="label">
          詞性
          <input id="editPos" class="input" placeholder="e.g. v." maxlength="16" />
        </label>

        <label class="label">
          中文
          <input id="editZh" class="input" maxlength="120" />
        </label>

        <div class="muted tiny">
          會做必填、格式與重複檢查；儲存前會再確認一次，避免手殘。
        </div>
      </div>

      <div class="modal-foot">
        <button id="btnCancelEdit" class="btn ghost">取消</button>
        <button id="btnSaveEdit" class="btn primary">儲存</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" hidden></div>

  <script src="./lz-string.min.js"></script>
  <script type="module" src="./app.js"></script>
</body>
</html>
